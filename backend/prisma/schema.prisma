generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
}

enum PapelUsuario {
  super_admin
  proprietario @map("owner")
  gerente @map("manager")
  operador @map("operator")

  @@map("UserRole")
}

enum StatusUsuario {
  ativo @map("active")
  pendente_aprovacao @map("pending_approval")
  rejeitado @map("rejected")
  suspenso @map("suspended")

  @@map("UserStatus")
}

enum StatusFinanceiro {
  ok @map("ok")
  atrasado @map("late")
  inadimplente @map("overdue")
  pendente @map("pending")

  @@map("FinancialStatus")
}

enum StatusPropriedade {
  ativa @map("active")
  pendente @map("pending")
  suspensa @map("suspended")

  @@map("PropertyStatus")
}

enum TipoPlano {
  porteira
  piquete
  retiro
  estancia
  barao

  @@map("PlanType")
}

enum StatusAssinatura {
  ativa @map("active")
  cancelada @map("canceled")
  inadimplente @map("past_due")

  @@map("SubscriptionStatus")
}

enum TipoMovimento {
  nascimento @map("birth")
  morte @map("death")
  venda @map("sale")
  compra @map("purchase")
  vacina @map("vaccine")
  ajuste @map("adjustment")

  @@map("MovementType")
}

enum TipoSexo {
  macho @map("male")
  femea @map("female")

  @@map("SexType")
}

model Usuario {
  id                String          @id @default(uuid()) @map("id")
  nome              String          @map("name")
  email             String          @unique @map("email")
  cpfCnpj           String          @unique @map("cpfCnpj")
  telefone          String?         @map("phone")
  senha             String          @map("password")
  papel             PapelUsuario    @default(operador) @map("role")
  status            StatusUsuario   @default(pendente_aprovacao) @map("status")
  ultimoLogin       DateTime?       @map("lastLogin")
  versaoApp         String?         @map("appVersion")
  statusFinanceiro  StatusFinanceiro? @map("financialStatus")
  receitaMensal     Float?          @map("monthlyRevenue")
  onboardingConcluidoEm DateTime?   @map("onboardingCompletedAt")
  criadoEm          DateTime        @default(now()) @map("createdAt")
  atualizadoEm      DateTime        @updatedAt @map("updatedAt")
  propriedades      UsuarioPropriedade[]
  preferencias      PreferenciasUsuario[]
  assinaturas       Assinatura[]
  notificacoes      NotificacaoUsuario[]

  @@map("User")
}

model Assinatura {
  id          String          @id @default(uuid()) @map("id")
  usuarioId   String          @map("userId")
  plano       TipoPlano       @default(porteira) @map("plan")
  status      StatusAssinatura @default(ativa) @map("status")
  valorMensal Float?          @map("monthlyAmount")
  inicioEm    DateTime        @default(now()) @map("startAt")
  fimEm       DateTime?       @map("endAt")
  criadoEm    DateTime        @default(now()) @map("createdAt")
  atualizadoEm DateTime       @updatedAt @map("updatedAt")
  usuario     Usuario         @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@map("Subscription")
}

model Propriedade {
  id              String             @id @default(uuid()) @map("id")
  nome            String             @unique @map("name")
  cidade          String             @map("city")
  estado          String             @map("state")
  cep             String?            @map("cep")
  logradouro      String?            @map("street")
  numero          String?            @map("number")
  complemento     String?            @map("complement")
  bairro          String?            @map("district")
  viaAcesso       String?            @map("accessRoute")
  comunidade      String?            @map("community")
  areaTotal       Float              @map("totalArea")
  areaCultivada   Float              @map("cultivatedArea")
  areaNatural     Float              @map("naturalArea")
  quantidadeGado  Int                @map("cattleCount")
  status          StatusPropriedade  @default(ativa) @map("status")
  plano           TipoPlano          @default(porteira) @map("plan")
  criadoEm        DateTime           @default(now()) @map("createdAt")
  atualizadoEm    DateTime           @updatedAt @map("updatedAt")
  usuarios        UsuarioPropriedade[]
  preferencias    PreferenciasUsuario[]
  rebanho         Rebanho[]
  movimentos      Movimento[]
  questionariosEpidemiologicos QuestionarioEpidemiologico[]
  validacoesDocumentoPublico ValidacaoDocumentoPublico[]

  @@map("Property")
}

model UsuarioPropriedade {
  id            String       @id @default(uuid()) @map("id")
  usuarioId     String       @map("userId")
  propriedadeId String       @map("propertyId")
  usuario       Usuario      @relation(fields: [usuarioId], references: [id])
  propriedade   Propriedade  @relation(fields: [propriedadeId], references: [id])

  @@unique([usuarioId, propriedadeId])
  @@map("UserProperty")
}

model PreferenciasUsuario {
  id                   String     @id @default(uuid()) @map("id")
  usuarioId            String     @map("userId")
  propriedadeId        String     @map("propertyId")
  notificacoes         Boolean    @default(true) @map("notifications")
  sincronizacaoAuto    Boolean    @default(true) @map("autoSync")
  modoEscuro           Boolean    @default(false) @map("darkMode")
  notificacaoNascimento Boolean   @default(true) @map("notifyBirth")
  notificacaoMorte     Boolean    @default(true) @map("notifyDeath")
  notificacaoVacina    Boolean    @default(true) @map("notifyVaccine")
  criadoEm             DateTime   @default(now()) @map("createdAt")
  atualizadoEm         DateTime   @updatedAt @map("updatedAt")
  usuario              Usuario    @relation(fields: [usuarioId], references: [id])
  propriedade          Propriedade @relation(fields: [propriedadeId], references: [id])

  @@unique([usuarioId, propriedadeId])
  @@map("UserPreferences")
}

model Rebanho {
  id            String    @id @default(uuid()) @map("id")
  propriedadeId String    @map("propertyId")
  especie       String    @map("species")
  faixaEtaria   String    @map("ageGroup")
  sexo          TipoSexo  @map("sex")
  cabecas       Int       @map("headcount")
  criadoEm      DateTime  @default(now()) @map("createdAt")
  atualizadoEm  DateTime  @updatedAt @map("updatedAt")
  propriedade   Propriedade @relation(fields: [propriedadeId], references: [id])

  @@map("Livestock")
}

model Movimento {
  id            String       @id @default(uuid()) @map("id")
  propriedadeId String       @map("propertyId")
  tipo          TipoMovimento @map("type")
  especie       String?      @default("bovino") @map("species")
  data          DateTime     @map("date")
  quantidade    Int          @map("quantity")
  sexo          TipoSexo?    @map("sex")
  faixaEtaria   String?      @map("ageGroup")
  descricao     String       @map("description")
  destino       String?      @map("destination")
  valor         Float?       @map("value")
  numeroGta     String?      @map("gtaNumber")
  fotoUrl       String?      @map("photoUrl")
  fotoData      Bytes?       @map("photoData")
  fotoMimeType  String?      @map("photoMimeType")
  causa         String?      @map("cause")
  criadoEm      DateTime     @default(now()) @map("createdAt")
  propriedade   Propriedade  @relation(fields: [propriedadeId], references: [id])

  @@map("Movement")
}

model QuestionarioEpidemiologico {
  id            String      @id @default(uuid()) @map("id")
  propriedadeId String      @map("propertyId")
  versao        Int         @default(1) @map("version")
  respostas     Json        @map("answers")
  enviadoEm     DateTime    @default(now()) @map("submittedAt")
  proximoEm     DateTime    @map("nextDueAt")
  criadoEm      DateTime    @default(now()) @map("createdAt")
  atualizadoEm  DateTime    @updatedAt @map("updatedAt")
  propriedade   Propriedade @relation(fields: [propriedadeId], references: [id])

  @@index([propriedadeId, enviadoEm])
  @@map("EpidemiologySurvey")
}

model SolicitacaoPendente {
  id               String   @id @default(uuid()) @map("id")
  nome             String   @map("name")
  cpfCnpj          String   @map("cpfCnpj")
  email            String   @map("email")
  telefone         String   @map("phone")
  plano            String   @map("plan")
  tipo             String   @map("type")
  status           String   @map("status")
  enviadoEm        DateTime @map("submittedAt")
  origem           String?  @map("source")
  nomePropriedade  String?  @map("propertyName")
  observacoes      String?  @map("notes")

  @@map("PendingRequest")
}

model RegulamentacaoEstadual {
  id                 String   @id @default(uuid()) @map("id")
  uf                 String   @map("uf")
  nomeEstado         String   @map("stateName")
  prazoEntrega       Int      @map("reportingDeadline")
  documentosObrigatorios String[] @map("requiredDocuments")
  frequenciaRelatorioSaldo String @map("saldoReportFrequency")
  diaRelatorioSaldo  Int      @map("saldoReportDay")
  gtaObrigatoria     Boolean  @map("gtaRequired")
  observacoes        String   @map("observations")
  atualizadoEm       DateTime @default(now()) @map("updatedAt")
  atualizadoPor      String   @map("updatedBy")

  @@map("StateRegulation")
}

model PagamentoFinanceiro {
  id                String   @id @default(uuid()) @map("id")
  tenantId          String   @map("tenantId")
  tenantName        String   @map("tenantName")
  plano             String   @map("plan")
  valor             Float    @map("amount")
  metodoPagamento   String   @map("paymentMethod")
  frequenciaPagamento String @map("paymentFrequency")
  status            String   @map("status")
  vencimentoEm      DateTime @map("dueDate")
  pagoEm            DateTime? @map("paidAt")
  criadoEm          DateTime @default(now()) @map("createdAt")

  @@map("FinancialPayment")
}

model ConfiguracaoPix {
  id            String   @id @default(uuid()) @map("id")
  chavePix      String   @map("pixKey")
  tipoChavePix  String   @map("pixKeyType")
  imagemQrCode  String?  @map("qrCodeImage")
  ativo         Boolean  @default(true) @map("active")
  criadoEm      DateTime @default(now()) @map("createdAt")
  atualizadoEm  DateTime @updatedAt @map("updatedAt")

  @@map("PixConfig")
}

model PlanoSaas {
  id        String   @id @default(uuid()) @map("id")
  nome      String   @unique @map("name")
  preco     Float    @map("price")
  maxCabecas Int?    @map("maxCattle")
  cobrancaAdicionalAtiva Boolean @default(false) @map("additionalChargeEnabled")
  valorCobrancaAdicional Float   @default(0.10) @map("additionalChargePerHead")
  recursos  String[] @default([]) @map("features")
  ativo     Boolean  @default(true) @map("active")
  criadoEm  DateTime @default(now()) @map("createdAt")
  atualizadoEm DateTime @updatedAt @map("updatedAt")

  @@map("Plan")
}

model CupomIndicacao {
  id          String   @id @default(uuid()) @map("id")
  codigo      String   @unique @map("code")
  tipo        String   @map("type")
  valor       Float    @map("value")
  quantidadeUso Int    @default(0) @map("usageCount")
  maxUso      Int?     @map("maxUsage")
  comissao    Float    @default(0) @map("commission")
  criadoPor   String   @map("createdBy")
  status      String   @default("active") @map("status")
  criadoEm    DateTime @default(now()) @map("createdAt")
  atualizadoEm DateTime @updatedAt @map("updatedAt")

  @@map("Coupon")
}

model IndicadorParceiro {
  id                 String   @id @default(uuid()) @map("id")
  nome               String   @map("name")
  codigo             String   @unique @map("code")
  indicacoes         Int      @default(0) @map("referrals")
  comissaoTotal      Float    @default(0) @map("totalCommission")
  comissaoPendente   Float    @default(0) @map("pendingCommission")
  status             String   @default("active") @map("status")
  criadoEm           DateTime @default(now()) @map("createdAt")
  atualizadoEm       DateTime @updatedAt @map("updatedAt")

  @@map("Referrer")
}

model ComunicacaoAdmin {
  id            String   @id @default(uuid()) @map("id")
  tipo          String   @map("type")
  titulo        String   @map("title")
  mensagem      String   @map("message")
  enviadoEm     DateTime @default(now()) @map("sentAt")
  destinatarios Int      @default(0) @map("recipients")
  status        String   @map("status")
  publicoAlvo   String   @map("targetAudience")
  cor           String?  @map("color")
  inicioEm      DateTime? @map("startDate")
  fimEm         DateTime? @map("endDate")
  criadoEm      DateTime @default(now()) @map("createdAt")
  atualizadoEm  DateTime @updatedAt @map("updatedAt")

  @@map("AdminCommunication")
}

model LogAuditoria {
  id        String   @id @default(uuid()) @map("id")
  usuarioId String   @map("userId")
  usuarioNome String @map("userName")
  acao      String   @map("action")
  detalhes  String   @map("details")
  ip        String   @map("ip")
  dataHora  DateTime @default(now()) @map("timestamp")

  @@map("AuditLog")
}

model NotificacaoUsuario {
  id            String   @id @default(uuid()) @map("id")
  usuarioId     String   @map("userId")
  notificacaoId String   @map("notificationId")
  status        String   @default("unread") @map("status")
  lidoEm        DateTime? @map("readAt")
  criadoEm      DateTime @default(now()) @map("createdAt")
  atualizadoEm  DateTime @updatedAt @map("updatedAt")
  usuario       Usuario  @relation(fields: [usuarioId], references: [id])

  @@unique([usuarioId, notificacaoId])
  @@index([usuarioId])
  @@map("UserNotification")
}

model ValidacaoDocumentoPublico {
  id            String      @id @default(uuid()) @map("id")
  tokenHash     String      @unique @map("tokenHash")
  propriedadeId String      @map("propertyId")
  tipoDocumento String      @map("documentType")
  numeroDocumento String    @map("documentNumber")
  expiraEm      DateTime    @map("expiresAt")
  revogadoEm    DateTime?   @map("revokedAt")
  criadoEm      DateTime    @default(now()) @map("createdAt")
  propriedade   Propriedade @relation(fields: [propriedadeId], references: [id])

  @@index([propriedadeId])
  @@index([expiraEm])
  @@map("PublicDocumentValidation")
}
